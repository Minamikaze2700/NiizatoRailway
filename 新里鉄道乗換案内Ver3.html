<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>新里鉄道 乗換案内</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg:#f1f5f9;
  --card:#fff;
  --muted:#667085;
  --radius:12px;
  --gutter:34px;
  --dotMajor:16px;
  --dotMinor:12px;
  --lineWMajor:5px;
  --lineWMinor:5px;
  --font-sans:"Hiragino Kaku Gothic ProN","Meiryo",system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;
}
html,body{height:100%;margin:0;font-family:var(--font-sans);background:var(--bg);color:#0b1324}
.wrap{max-width:980px;margin:28px auto;padding:20px}
h1{margin:0 0 12px;font-size:20px}
.card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 8px 24px rgba(2,6,23,0.07);margin-bottom:12px}
.row{display:flex;gap:12px;align-items:center}
.col{display:flex;flex-direction:column;gap:6px;position:relative}
select,button{font-size:14px;padding:8px 10px;border-radius:4px;border:1px solid #d1d5db;background:#fff}
label{font-size:13px;color:var(--muted)}
button.primary{cursor:pointer;background:#0b5fff;color:#fff;border:none}
.resultHeader{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
.resultHeader .meta{display:flex;gap:18px;color:#111}

/* 路線図レイアウト */
.routeLine{display:flex;flex-direction:column;gap:0;margin-top:4px}
.rowStation{display:grid;grid-template-columns:var(--gutter) 1fr;column-gap:10px;align-items:center;}
.railCol{display:flex;flex-direction:column;align-items:center;position:relative;justify-content:flex-start;}
.railDot{border-radius:50%;width:var(--dotMajor);height:var(--dotMajor);flex:0 0 auto;z-index:1;}
.railLineMajor{width:var(--lineWMajor);border-radius:2px;position:absolute;left:50%;transform:translateX(-50%);z-index:0;}
.railLineMinor{width:var(--lineWMinor);border-radius:1px;}

.stationText{display:flex;flex-direction:column;align-items:flex-start; justify-content:center;}
.stationName{font-weight:700;font-size:16px;line-height:1.25}
.lineBadge{display:inline-block;color:#fff;font-size:12px;line-height:1;padding:2px 6px;border-radius:6px;margin-top:2px;white-space:nowrap}
.toggleWrap{margin-top:4px}
.toggleBtn{cursor:pointer;padding:4px 8px;font-size:12px;border-radius:4px}

.betweenList{display:none;}
.rowBetween{
  display:grid;
  grid-template-columns:var(--gutter) 1fr;
  column-gap:10px;
  align-items:center; /* 丸と駅名を縦中央に */
}
.rowBetween .railCol{display:flex;align-items:center;justify-content:center;position:relative;} /* 丸を駅名に合わせる */
.minorName{font-size:14px;font-weight:400}
.spacer4{height:4px}
.spacer6{height:6px}
</style>
</head>
<body>
<div class="wrap">
<h1>新里鉄道 乗換案内</h1>
<div class="card">
  <div class="row">
    <div class="col" style="flex:1"><label>出発路線</label><select id="fromLine"></select></div>
    <div class="col" style="flex:1"><label>出発駅</label><select id="fromStation"></select></div>
    <div class="col" style="flex:1"><label>到着路線</label><select id="toLine"></select></div>
    <div class="col" style="flex:1"><label>到着駅</label><select id="toStation"></select></div>
    <div style="display:flex;align-items:flex-end;"><button id="searchBtn" class="primary">検索</button></div>
  </div>
</div>
<div id="resultArea"></div>
</div>

<script>
const stationLines = {
  "湯の浜線":["豊町","東豊町","清水浜","安田町","南栃原","栃原","宇城","須川","御浜埼公園","御浜","伊坂","垳下","北浜","西新里","新里","河岸","新里海浜公園","湯の浜海岸","湯の浜","七浦","那珂町","宇多野","伊奈崎","鶴宮神社","鶴宮","北鶴宮"],
  "燠野線":["湯の浜","新里大学前","綾原","福来","燠野","湯川","温泉口","燠野温泉"],
  "鶴宮線":["鶴宮","南鶴宮","あずさ台","橘町","燠野山口","白枝","燠野","紅葉台","桐山","湊川","彩山親水公園","彩山","蓮華寺","星宮","田ノ原"],
  "新里線":["新里","南新里","田ノ原","北玖川","玖川","中野原"],
  "彩山線":["彩山","彩山口","新里国際スキー場","鷹見台","久我原","浪原","深江","三栗谷","桜川公園","桜川"]
};
const lineColors = {"湯の浜線":"#00bfff","燠野線":"#ff4d6d","鶴宮線":"#ffa500","新里線":"#228b22","彩山線":"#32cd32"};

const rawGraph={"豊町":{"東豊町":1.2},"東豊町":{"清水浜":1.4},"清水浜":{"安田町":1.9},"安田町":{"南栃原":2.2},"南栃原":{"栃原":0.9},"栃原":{"宇城":2.2},"宇城":{"須川":2.1},"須川":{"御浜埼公園":1.9},"御浜埼公園":{"御浜":0.6},"御浜":{"伊坂":2.5},"伊坂":{"垳下":2.6},"垳下":{"北浜":2.3},"北浜":{"西新里":1.4},"西新里":{"新里":1.7},"新里":{"河岸":0.9,"南新里":2.5},"河岸":{"新里海浜公園":1.7},"新里海浜公園":{"湯の浜海岸":2.3},"湯の浜海岸":{"湯の浜":1.5},"湯の浜":{"七浦":2.5,"新里大学前":0.8},"七浦":{"那珂町":1.6},"那珂町":{"宇多野":2.2},"宇多野":{"伊奈崎":1.8},"伊奈崎":{"鶴宮神社":1.5},"鶴宮神社":{"鶴宮":1.2},"鶴宮":{"北鶴宮":1.1,"南鶴宮":1.7},"新里大学前":{"綾原":0.7},"綾原":{"福来":1.2},"福来":{"燠野":1.4},"燠野":{"湯川":2.6,"紅葉台":1.1},"湯川":{"温泉口":1.6},"温泉口":{"燠野温泉":1.9},"南鶴宮":{"あずさ台":1.4},"あずさ台":{"橘町":1.8},"橘町":{"燠野山口":1.1},"燠野山口":{"白枝":1.2},"白枝":{"燠野":1.1},"紅葉台":{"桐山":0.8},"桐山":{"湊川":0.8},"湊川":{"彩山親水公園":1.1},"彩山親水公園":{"彩山":1.2},"彩山":{"蓮華寺":0.8,"彩山口":2.1},"蓮華寺":{"星宮":1.1},"星宮":{"田ノ原":1.1},"南新里":{"田ノ原":2.3},"田ノ原":{"北玖川":2.4},"北玖川":{"玖川":3.1},"玖川":{"中野原":3.1},"彩山口":{"新里国際スキー場":3.4},"新里国際スキー場":{"鷹見台":10.7},"鷹見台":{"久我原":2.7},"久我原":{"浪原":1.5},"浪原":{"深江":1.4},"深江":{"三栗谷":1.3},"三栗谷":{"桜川公園":1.5},"桜川公園":{"桜川":2.2}};

function buildGraphBidirectional(raw){
  const g={};
  for(const [a,edges] of Object.entries(raw)){
    if(!g[a]) g[a]={};
    for(const [b,d] of Object.entries(edges)){
      g[a][b]=d;
      if(!g[b]) g[b]={};
      if(g[b][a]==null) g[b][a]=d;
    }
  }
  return g;
}
const graph=buildGraphBidirectional(rawGraph);
const allStations=Array.from(new Set([...Object.keys(graph),...Object.values(graph).flatMap(x=>Object.keys(x))])).sort();

function fareFromTotalDistance(km){if(km<=1)return 130;if(km<=2)return 140;if(km<=3)return 150;if(km<=5)return 170;if(km<=8)return 200;if(km<=12)return 240;if(km<=20)return 290;if(km<=30)return 350;if(km<=40)return 420;if(km<=50)return 490;if(km<=59)return 540;return 540;}
function findLineOfSegment(a,b){for(const [line,stations] of Object.entries(stationLines)){const ia=stations.indexOf(a),ib=stations.indexOf(b);if(ia!==-1&&ib!==-1&&Math.abs(ia-ib)===1) return line;}return null;}
function shortestPath(start,goal){if(!graph[start]||!graph[goal]) return {path:[],distance:Infinity};const dist={},prev={},Q=new Set(allStations);allStations.forEach(s=>{dist[s]=Infinity;prev[s]=null;});dist[start]=0;while(Q.size){let u=null,best=Infinity;for(const v of Q){ if(dist[v]<best){u=v;best=dist[v];} }if(u===null) break;Q.delete(u);if(u===goal) break;for(const [v,w] of Object.entries(graph[u]||{})){const alt=dist[u]+w;if(alt<dist[v]){dist[v]=alt;prev[v]=u;}}}if(!isFinite(dist[goal])) return {path:[],distance:Infinity};const path=[];for(let cur=goal;cur!=null;cur=prev[cur]) path.unshift(cur);return {path,distance:dist[goal]};}
  function majorStops(path) {
  // 途中駅も含む駅情報を整理
  return path.map(station => ({
    name: station,
    line: Object.entries(stationLines).find(([line, stations]) => stations.includes(station))[0],
    isMajor: stationLines[Object.entries(stationLines).find(([line, stations]) => stations.includes(station))[0]].indexOf(station) === 0 || 
             stationLines[Object.entries(stationLines).find(([line, stations]) => stations.includes(station))[0]].indexOf(station) ===
             stationLines[Object.entries(stationLines).find(([line, stations]) => stations.includes(station))[0]].length - 1
  }));
}

function drawRoute(path) {
  const routeArea = document.getElementById("resultArea");
  routeArea.innerHTML = "";

  const routeDiv = document.createElement("div");
  routeDiv.className = "routeLine";

  const stops = majorStops(path);

  for (let i = 0; i < stops.length; i++) {
    const stop = stops[i];

    const row = document.createElement("div");
    row.className = "rowStation";

    const railCol = document.createElement("div");
    railCol.className = "railCol";

    // 丸の作成
    const dot = document.createElement("div");
    dot.className = "railDot";
    dot.style.backgroundColor = lineColors[stop.line];
    railCol.appendChild(dot);

    // 線を追加（最後の駅は伸ばさない）
    if (i < stops.length - 1) {
      const lineDiv = document.createElement("div");
      lineDiv.className = stop.isMajor ? "railLineMajor" : "railLineMinor";
      lineDiv.style.height = "20px"; // 丸から丸まで20pxに統一
      lineDiv.style.backgroundColor = lineColors[stop.line];
      railCol.appendChild(lineDiv);
    }

    // 駅名
    const stationText = document.createElement("div");
    stationText.className = "stationText";
    const nameDiv = document.createElement("div");
    nameDiv.className = stop.isMajor ? "stationName" : "minorName";
    nameDiv.innerText = stop.name;
    stationText.appendChild(nameDiv);

    row.appendChild(railCol);
    row.appendChild(stationText);
    routeDiv.appendChild(row);
  }

  routeArea.appendChild(routeDiv);
}

document.getElementById("searchBtn").addEventListener("click", () => {
  const fromStation = document.getElementById("fromStation").value;
  const toStation = document.getElementById("toStation").value;
  if (!fromStation || !toStation) return;
  const {path} = shortestPath(fromStation, toStation);
  drawRoute(path);
});

// セレクトボックス初期化
function initSelectors() {
  const fromLineSelect = document.getElementById("fromLine");
  const fromStationSelect = document.getElementById("fromStation");
  const toLineSelect = document.getElementById("toLine");
  const toStationSelect = document.getElementById("toStation");

  Object.keys(stationLines).forEach(line => {
    const opt1 = document.createElement("option"); opt1.value=line; opt1.innerText=line; fromLineSelect.appendChild(opt1);
    const opt2 = document.createElement("option"); opt2.value=line; opt2.innerText=line; toLineSelect.appendChild(opt2);
  });

  function updateStations(selectLine, stationSelect) {
    const line = selectLine.value;
    stationSelect.innerHTML = "";
    stationLines[line].forEach(station => {
      const opt = document.createElement("option");
      opt.value = station;
      opt.innerText = station;
      stationSelect.appendChild(opt);
    });
  }

  fromLineSelect.addEventListener("change", () => updateStations(fromLineSelect, fromStationSelect));
  toLineSelect.addEventListener("change", () => updateStations(toLineSelect, toStationSelect));

  // 初期表示
  updateStations(fromLineSelect, fromStationSelect);
  updateStations(toLineSelect, toStationSelect);
}

initSelectors();
</script>
</body>
</html>
