<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ルート検索</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .station-dot {
      width: 14px;  /* 小さめのサイズ */
      height: 14px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
      flex-shrink: 0;
    }
    .station-dot.small {
      width: 10px;  /* 途中駅はさらに小さく（約75%） */
      height: 10px;
    }
    .station-label {
      font-size: 1.5em; /* 駅名を150%に拡大 */
    }
    .route-line {
      width: 4px;
      background-color: gray;
      margin: 0 auto;
    }
  </style>
</head>
<body class="p-6">
  <h1 class="text-2xl font-bold mb-4">ルート検索</h1>

  <div class="flex gap-4 mb-6">
    <div>
      <label class="font-semibold">発駅路線:</label>
      <select id="fromLine" class="border p-1"></select>
      <label class="font-semibold ml-2">駅:</label>
      <select id="fromStation" class="border p-1"></select>
    </div>
    <div>
      <label class="font-semibold">着駅路線:</label>
      <select id="toLine" class="border p-1"></select>
      <label class="font-semibold ml-2">駅:</label>
      <select id="toStation" class="border p-1"></select>
    </div>
    <button onclick="searchRoute()" class="bg-blue-500 text-white px-4 py-2 rounded">検索</button>
  </div>

  <div id="result" class="space-y-2"></div>

  <script>
    // ==== 駅・路線データ ====
    const stationLines = {
      "湯の浜線": [
        "豊町","東豊町","清水浜","安田町","南栃原","栃原","宇城","須川","御浜埼公園","御浜","伊坂","垳下","北浜","西新里","新里","河岸","新里海浜公園","湯の浜海岸","湯の浜","七浦","那珂町","宇多野","伊奈崎","鶴宮神社","鶴宮","北鶴宮"
      ],
      "燠野線": ["湯の浜","新里大学前","綾原","福来","燠野","湯川","温泉口","燠野温泉"],
      "鶴宮線": ["鶴宮","南鶴宮","あずさ台","橘町","燠野山口","白枝","燠野","紅葉台","桐山","湊川","彩山親水公園","彩山","蓮華寺","星宮","田ノ原"],
      "新里線": ["新里","南新里","田ノ原","北玖川","玖川","中野原"],
      "彩山線": ["彩山","彩山口","新里国際スキー場","鷹見台","久我原","浪原","深江","三栗谷","桜川公園","桜川"]
    };

    const lineColors = {
      "湯の浜線": "#07b5f7",
      "燠野線": "#fd5062",
      "新里線": "#0cab5e",
      "鶴宮線": "#feac2c",
      "彩山線": "#7dca22"
    };

    // ==== 駅間距離 ====
    const rawGraph = {
      "豊町":{"東豊町":1.2}, "東豊町":{"清水浜":1.4}, "清水浜":{"安田町":1.9}, "安田町":{"南栃原":2.2},
      "南栃原":{"栃原":0.9}, "栃原":{"宇城":2.2}, "宇城":{"須川":2.1}, "須川":{"御浜埼公園":1.9},
      "御浜埼公園":{"御浜":0.6}, "御浜":{"伊坂":2.5}, "伊坂":{"垳下":2.6}, "垳下":{"北浜":2.3},
      "北浜":{"西新里":1.4}, "西新里":{"新里":1.7}, "新里":{"河岸":0.9,"南新里":2.5}, "河岸":{"新里海浜公園":1.7},
      "新里海浜公園":{"湯の浜海岸":2.3}, "湯の浜海岸":{"湯の浜":1.5}, "湯の浜":{"七浦":2.5,"新里大学前":0.8},
      "七浦":{"那珂町":1.6}, "那珂町":{"宇多野":2.2}, "宇多野":{"伊奈崎":1.8}, "伊奈崎":{"鶴宮神社":1.5},
      "鶴宮神社":{"鶴宮":1.2}, "鶴宮":{"北鶴宮":1.1,"南鶴宮":1.7}, "新里大学前":{"綾原":0.7},
      "綾原":{"福来":1.2}, "福来":{"燠野":1.4}, "燠野":{"湯川":2.6,"紅葉台":1.1}, "湯川":{"温泉口":1.6},
      "温泉口":{"燠野温泉":1.9}, "南鶴宮":{"あずさ台":1.4}, "あずさ台":{"橘町":1.8}, "橘町":{"燠野山口":1.1},
      "燠野山口":{"白枝":1.2}, "白枝":{"燠野":1.1}, "紅葉台":{"桐山":0.8}, "桐山":{"湊川":0.8},
      "湊川":{"彩山親水公園":1.1}, "彩山親水公園":{"彩山":1.2}, "彩山":{"蓮華寺":0.8,"彩山口":2.1},
      "蓮華寺":{"星宮":1.1}, "星宮":{"田ノ原":1.1}, "南新里":{"田ノ原":2.3}, "田ノ原":{"北玖川":2.4},
      "北玖川":{"玖川":3.1}, "玖川":{"中野原":3.1}, "彩山口":{"新里国際スキー場":3.4}, "新里国際スキー場":{"鷹見台":10.7},
      "鷹見台":{"久我原":2.7}, "久我原":{"浪原":1.5}, "浪原":{"深江":1.4}, "深江":{"三栗谷":1.3},
      "三栗谷":{"桜川公園":1.5}, "桜川公園":{"桜川":2.2}
    };
    const graph = {};
    for (const [from, targets] of Object.entries(rawGraph)) {
      if (!graph[from]) graph[from] = {};
      for (const [to, d] of Object.entries(targets)) {
        graph[from][to] = d;
        if (!graph[to]) graph[to] = {};
        graph[to][from] = d;
      }
    }

    // ==== ダイクストラで最短経路探索 ====
    function dijkstra(start, goal) {
      const dist = {}, prev = {};
      const pq = new Set(Object.keys(graph));
      for (const v of pq) dist[v] = Infinity;
      dist[start] = 0;

      while (pq.size) {
        let u = [...pq].reduce((a, b) => dist[a] < dist[b] ? a : b);
        pq.delete(u);
        if (u === goal) break;

        for (const [v, w] of Object.entries(graph[u])) {
          if (!pq.has(v)) continue;
          let alt = dist[u] + w;
          if (alt < dist[v]) {
            dist[v] = alt;
            prev[v] = u;
          }
        }
      }

      const path = [];
      let u = goal;
      while (u) {
        path.unshift(u);
        u = prev[u];
      }
      return path;
    }

    // ==== UI初期化 ====
    const fromLineSel = document.getElementById("fromLine");
    const toLineSel = document.getElementById("toLine");
    const fromStationSel = document.getElementById("fromStation");
    const toStationSel = document.getElementById("toStation");

    function populateLines() {
      for (const line of Object.keys(stationLines)) {
        const opt1 = new Option(line, line);
        const opt2 = new Option(line, line);
        fromLineSel.add(opt1);
        toLineSel.add(opt2);
      }
      fromLineSel.onchange = () => populateStations(fromLineSel, fromStationSel);
      toLineSel.onchange = () => populateStations(toLineSel, toStationSel);
      populateStations(fromLineSel, fromStationSel);
      populateStations(toLineSel, toStationSel);
    }

    function populateStations(lineSel, stationSel) {
      stationSel.innerHTML = "";
      for (const st of stationLines[lineSel.value]) {
        stationSel.add(new Option(st, st));
      }
    }

    populateLines();

    // ==== 検索処理 ====
    function searchRoute() {
      const from = fromStationSel.value;
      const to = toStationSel.value;
      const path = dijkstra(from, to);
      renderRoute(path);
    }

    // ==== 表示 ====
    function renderRoute(path) {
      const container = document.getElementById("result");
      container.innerHTML = "";

      for (let i = 0; i < path.length; i++) {
        const station = path[i];
        const line = findLine(path[i], path[i+1]);
        const color = line ? lineColors[line] : "#666";

        const row = document.createElement("div");
        row.className = "flex items-center";

        const dot = document.createElement("span");
        dot.className = "station-dot";
        dot.style.background = color;

        const label = document.createElement("span");
        label.className = "station-label";
        label.textContent = station;

        row.appendChild(dot);
        row.appendChild(label);
        container.appendChild(row);

        if (i < path.length-1) {
          const lineDiv = document.createElement("div");
          lineDiv.className = "route-line";
          lineDiv.style.background = color;
          lineDiv.style.height = "20px";
          container.appendChild(lineDiv);
        }
      }
    }

    function findLine(st1, st2) {
      if (!st2) return null;
      for (const [line, stations] of Object.entries(stationLines)) {
        if (stations.includes(st1) && stations.includes(st2)) {
          return line;
        }
      }
      return null;
    }
  </script>
</body>
</html>
