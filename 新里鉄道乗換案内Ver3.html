<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>新里鉄道 運賃検索</title>
  <style>
    body { font-family: sans-serif; }
    #map { margin: 20px 0; }
    .station { text-anchor: middle; font-size: 12px; }
    .line { stroke-width: 4; fill: none; }
    .intermediate { fill: black; }
    button { margin: 5px; }
  </style>
</head>
<body>
  <h1>新里鉄道 運賃検索</h1>

  <div>
    出発駅: <select id="fromStation"></select>
    到着駅: <select id="toStation"></select>
    <button onclick="searchRoute()">検索</button>
  </div>

  <div id="result"></div>
  <button id="toggleBtn" style="display:none;" onclick="toggleIntermediate()"></button>

  <svg id="map" width="800" height="200"></svg>

  <script>
  // ==== 駅・路線データ ====
  const stationLines = {
    "湯の浜線":["豊町","東豊町","清水浜","安田町","南栃原","栃原","宇城","須川","御浜埼公園","御浜","伊坂","垳下","北浜","西新里","新里","河岸","新里海浜公園","湯の浜海岸","湯の浜","七浦","那珂町","宇多野","伊奈崎","鶴宮神社","鶴宮","北鶴宮"],
    "燠野線":["湯の浜","新里大学前","綾原","福来","燠野","湯川","温泉口","燠野温泉"],
    "鶴宮線":["鶴宮","南鶴宮","あずさ台","橘町","燠野山口","白枝","燠野","紅葉台","桐山","湊川","彩山親水公園","彩山","蓮華寺","星宮","田ノ原"],
    "新里線":["新里","南新里","田ノ原","北玖川","玖川","中野原"],
    "彩山線":["彩山","彩山口","新里国際スキー場","鷹見台","久我原","浪原","深江","三栗谷","桜川公園","桜川"]
  };

  const lineColors = {
    "湯の浜線":"#07b5f7",
    "燠野線":"#fd5062",
    "新里線":"#0cab5e",
    "鶴宮線":"#feac2c",
    "彩山線":"#7dca22"
  };

  // ==== グラフ距離データ（双方向） ====
  const rawGraph = {
    "豊町":{"東豊町":1.2},"東豊町":{"清水浜":1.4},"清水浜":{"安田町":1.9},
    "安田町":{"南栃原":2.2},"南栃原":{"栃原":0.9},"栃原":{"宇城":2.2},
    "宇城":{"須川":2.1},"須川":{"御浜埼公園":1.9},"御浜埼公園":{"御浜":0.6},
    "御浜":{"伊坂":2.5},"伊坂":{"垳下":2.6},"垳下":{"北浜":2.3},
    "北浜":{"西新里":1.4},"西新里":{"新里":1.7},"新里":{"河岸":0.9,"南新里":2.5},
    "河岸":{"新里海浜公園":1.7},"新里海浜公園":{"湯の浜海岸":2.3},"湯の浜海岸":{"湯の浜":1.5},
    "湯の浜":{"七浦":2.5,"新里大学前":0.8},"七浦":{"那珂町":1.6},"那珂町":{"宇多野":2.2},
    "宇多野":{"伊奈崎":1.8},"伊奈崎":{"鶴宮神社":1.5},"鶴宮神社":{"鶴宮":1.2},
    "鶴宮":{"北鶴宮":1.1,"南鶴宮":1.7},"新里大学前":{"綾原":0.7},"綾原":{"福来":1.2},
    "福来":{"燠野":1.4},"燠野":{"湯川":2.6,"紅葉台":1.1},"湯川":{"温泉口":1.6},
    "温泉口":{"燠野温泉":1.9},"南鶴宮":{"あずさ台":1.4},"あずさ台":{"橘町":1.8},
    "橘町":{"燠野山口":1.1},"燠野山口":{"白枝":1.2},"白枝":{"燠野":1.1},
    "紅葉台":{"桐山":0.8},"桐山":{"湊川":0.8},"湊川":{"彩山親水公園":1.1},
    "彩山親水公園":{"彩山":1.2},"彩山":{"蓮華寺":0.8,"彩山口":2.1},
    "蓮華寺":{"星宮":1.1},"星宮":{"田ノ原":1.1},"南新里":{"田ノ原":2.3},
    "田ノ原":{"北玖川":2.4},"北玖川":{"玖川":3.1},"玖川":{"中野原":3.1},
    "彩山口":{"新里国際スキー場":3.4},"新里国際スキー場":{"鷹見台":10.7},
    "鷹見台":{"久我原":2.7},"久我原":{"浪原":1.5},"浪原":{"深江":1.4},
    "深江":{"三栗谷":1.3},"三栗谷":{"桜川公園":1.5},"桜川公園":{"桜川":2.2}
  };

  const graph = {};
  for (const [f, tos] of Object.entries(rawGraph)) {
    if (!graph[f]) graph[f] = {};
    for (const [t, d] of Object.entries(tos)) {
      graph[f][t] = d;
      if (!graph[t]) graph[t] = {};
      graph[t][f] = d;
    }
  }

  // ==== 運賃計算 ====
  function fare(dist){
    if(dist<=3) return {adult:130,child:70};
    if(dist<=6) return {adult:160,child:80};
    if(dist<=10) return {adult:190,child:100};
    if(dist<=15) return {adult:220,child:110};
    if(dist<=20) return {adult:250,child:130};
    if(dist<=25) return {adult:280,child:140};
    if(dist<=30) return {adult:310,child:160};
    return {adult:340,child:170};
  }

  // ==== Dijkstraで最短経路 ====
  function shortestPath(start,goal){
    let dist={}, prev={}, pq=[start];
    for(const v in graph) dist[v]=Infinity;
    dist[start]=0;
    while(pq.length){
      pq.sort((a,b)=>dist[a]-dist[b]);
      const u=pq.shift();
      if(u===goal) break;
      for(const [v,w] of Object.entries(graph[u])){
        if(dist[u]+w<dist[v]){
          dist[v]=dist[u]+w; prev[v]=u; pq.push(v);
        }
      }
    }
    let path=[],u=goal;
    while(u){ path.unshift(u); u=prev[u]; }
    return {distance:dist[goal], path};
  }

  // ==== 初期化 ====
  const allStations=[...new Set(Object.keys(graph))];
  const fromSel=document.getElementById("fromStation");
  const toSel=document.getElementById("toStation");
  allStations.forEach(st=>{
    fromSel.add(new Option(st,st));
    toSel.add(new Option(st,st));
  });

  let showIntermediate=true;

  function searchRoute(){
    const from=fromSel.value,to=toSel.value;
    if(from===to) return;
    const {distance,path}=shortestPath(from,to);
    const f=fare(distance);
    document.getElementById("result").innerText=
      `距離:${distance.toFixed(1)}km 運賃:大人${f.adult}円 子供${f.child}円`;

    // SVG描画
    const svg=document.getElementById("map");
    svg.innerHTML="";
    const n=path.length-1;
    const y=100;
    for(let i=0;i<n;i++){
      svg.innerHTML+=`<line x1="${50+i*700/n}" y1="${y}" x2="${50+(i+1)*700/n}" y2="${y}" stroke="${getLineColor(path[i],path[i+1])}" class="line"/>`;
    }
    for(let i=0;i<path.length;i++){
      const x=50+i*700/n;
      svg.innerHTML+=`<circle cx="${x}" cy="${y}" r="6" fill="black"/>`;
      svg.innerHTML+=`<text x="${x}" y="${y+20}" class="station">${path[i]}</text>`;
    }
    // 途中駅の小さい●
    if(showIntermediate && path.length>2){
      for(let i=1;i<path.length-1;i++){
        const x=50+i*700/n;
        svg.innerHTML+=`<circle cx="${x}" cy="${y}" r="3" class="intermediate"/>`;
      }
    }

    // ボタン制御
    const btn=document.getElementById("toggleBtn");
    if(path.length>2){
      btn.style.display="inline";
      btn.innerText= showIntermediate?"途中駅を表示しない":"途中駅を表示";
    } else {
      btn.style.display="inline";
      btn.innerText="途中駅を表示しない";
    }
  }

  function toggleIntermediate(){
    showIntermediate=!showIntermediate;
    searchRoute();
  }

  function getLineColor(a,b){
    for(const [line,sts] of Object.entries(stationLines)){
      for(let i=0;i<sts.length-1;i++){
        if((sts[i]===a&&sts[i+1]===b)||(sts[i]===b&&sts[i+1]===a)) return lineColors[line];
      }
    }
    return "gray";
  }
  </script>
</body>
</html>
