<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>新里鉄道路線検索</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h1 { font-size: 20px; }
    select, button { margin: 5px; padding: 5px; }
    .route-line {
      color: white; padding: 2px 6px; border-radius: 6px; margin: 0 3px;
    }
  </style>
</head>
<body>
  <h1>新里鉄道路線検索</h1>
  <div>
    出発駅: <select id="start"></select>
    到着駅: <select id="end"></select>
    <button onclick="searchRoute()">検索</button>
  </div>
  <div id="result" style="margin-top:20px; font-size:16px;"></div>

  <script>
    // --- 各路線の駅リスト ---
    const stationLines = {
      "新里線": ["新里","田ノ原","鶴宮"],
      "湯の浜線": ["湯の浜","燠野","新里"],
      "燠野線": ["湯の浜","燠野"],
      "鶴宮線": ["鶴宮","彩山","彩山親水公園","南鶴宮"],
      "彩山線": ["彩山","彩山親水公園"]
    };

    // --- 路線ごとの色 ---
    const lineColors = {
      "新里線": "green",
      "湯の浜線": "blue",
      "燠野線": "orange",
      "鶴宮線": "red",
      "彩山線": "purple"
    };

    // 駅一覧
    const allStations = [...new Set(Object.values(stationLines).flat())];
    const startSel = document.getElementById("start");
    const endSel = document.getElementById("end");

    allStations.forEach(st=>{
      startSel.add(new Option(st,st));
      endSel.add(new Option(st,st));
    });

    // --- 路線判定（2駅が隣接する場合） ---
    function getLine(from,to){
      for(const [line,stations] of Object.entries(stationLines)){
        for(let i=0;i<stations.length-1;i++){
          if((stations[i]===from && stations[i+1]===to) ||
             (stations[i]===to && stations[i+1]===from)){
            return line;
          }
        }
      }
      return null;
    }

    // --- 隣接駅リストを作成 ---
    function buildGraph(){
      const g={};
      for(const [line,stations] of Object.entries(stationLines)){
        for(let i=0;i<stations.length-1;i++){
          const a=stations[i], b=stations[i+1];
          if(!g[a]) g[a]=[];
          if(!g[b]) g[b]=[];
          g[a].push(b);
          g[b].push(a);
        }
      }
      return g;
    }

    // --- BFSで最短経路探索 ---
    function bfs(start,goal){
      const graph=buildGraph();
      const q=[[start]];
      const visited=new Set([start]);
      while(q.length>0){
        const path=q.shift();
        const last=path[path.length-1];
        if(last===goal) return path;
        for(const nxt of (graph[last]||[])){
          if(!visited.has(nxt)){
            visited.add(nxt);
            q.push([...path,nxt]);
          }
        }
      }
      return null;
    }

    // --- 検索処理 ---
    function searchRoute(){
      const start=startSel.value;
      const goal=endSel.value;
      if(start===goal){
        document.getElementById("result").innerText="同じ駅です。";
        return;
      }
      const path=bfs(start,goal);
      if(!path){
        document.getElementById("result").innerText="ルートが見つかりません。";
        return;
      }

      // 経路をHTML化
      let html="";
      for(let i=0;i<path.length-1;i++){
        const from=path[i], to=path[i+1];
        let line=getLine(from,to);

        // nullが返った場合の補正（例: 新里-田ノ原）
        if(!line && ( (from==="新里" && to==="田ノ原") || (from==="田ノ原" && to==="新里") )){
          line="新里線";
        }

        html+=from;
        if(line){
          html+=` <span class="route-line" style="background:${lineColors[line]}">新里鉄道 ${line}</span> `;
        }
      }
      html+=path[path.length-1];

      document.getElementById("result").innerHTML=html;
    }
  </script>
</body>
</html>
