<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>新里地方 乗換案内</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg:#f1f5f9;
  --card:#fff;
  --muted:#667085;
  --radius:12px;
  --gutter:34px;
  --dotMajor:16px;
  --dotMinor:12px;
  --lineWMajor:5px;
  --lineWMinor:5px;
  --font-sans:"Hiragino Kaku Gothic ProN","Meiryo",system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;
}
html,body{height:100%;margin:0;font-family:var(--font-sans);background:var(--bg);color:#0b1324}
.wrap{max-width:980px;margin:28px auto;padding:20px}
h1{margin:0 0 12px;font-size:20px}
.card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 8px 24px rgba(2,6,23,0.07);margin-bottom:12px}
.row{display:flex;gap:12px;align-items:flex-start;flex-direction:column}
.col{display:flex;flex-direction:column;gap:6px;position:relative;align-items:flex-start}
select,button{font-size:14px;padding:8px 10px;border-radius:4px;border:1px solid #d1d5db;background:#fff}
label{font-size:13px;color:var(--muted)}
button.primary{cursor:pointer;background:#0b5fff;color:#fff;border:none}
.resultHeader{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
.resultHeader .meta{display:flex;gap:18px;color:#111}

/* 路線図レイアウト */
.routeLine{display:flex;flex-direction:column;gap:10px;margin-top:4px}
.rowStation{display:grid;grid-template-columns:var(--gutter) 1fr;align-items:start;column-gap:10px;position:relative;}
.railCol{display:flex;flex-direction:column;align-items:center;position:relative;}
.railDot{border-radius:50%;width:var(--dotMajor);height:var(--dotMajor);z-index:2;border:2px solid #fff;position:absolute;left:50%;top:0;transform:translateX(-50%);box-sizing:content-box;}
.rowBetween .railDot{width:var(--dotMinor);height:var(--dotMinor);border:2px solid #fff;position:absolute;left:50%;top:0;transform:translateX(-50%);z-index:2;}
.railLineMajor{width:var(--lineWMajor);border-radius:2px;position:absolute;left:50%;transform:translateX(-50%);z-index:1;top:0;height:0;background:#999;}
.railLineMinor{width:var(--lineWMinor);border-radius:1px;position:absolute;left:50%;transform:translateX(-50%);z-index:1;top:0;height:0;background:#999;}
.stationText{display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start}
.stationName{font-weight:700;font-size:16px;line-height:1.25;margin:0}
.lineBadge{display:inline-block;color:#fff;font-size:13.5px;line-height:1;padding:2px 6px;border-radius:6px;margin-top:6px;white-space:nowrap}
.toggleWrap{margin-top:6px}
.toggleBtn{cursor:pointer;padding:4px 8px;font-size:12px}
.rowBetween{display:grid;grid-template-columns:var(--gutter) 1fr;column-gap:10px;align-items:start;height:auto;padding-top:12px}
.rowBetween .stationText{display:flex;align-items:flex-start;padding-top:0}
.minorName{font-size:14px;font-weight:400;margin:0;position:relative;top:-4px}
.rowBetween .railLineMinor{height:48px}
.betweenList{ display:none; }
.spacer4{height:4px}
.spacer6{height:6px}
.viaList{display:flex;flex-direction:column;gap:6px;margin:6px 0;align-items:flex-start}
.viaRow{display:flex;align-items:center;gap:6px;justify-content:flex-start}
.viaRow button{font-size:12px;padding:4px 6px}
</style>
</head>
<body>
<div class="wrap">
<h1>新里地方 乗換案内</h1>

<div class="card">
  <div id="stationSelector">
    <div class="row">
      <div class="col">
        <label>発駅</label>
        <div style="display:flex;gap:6px">
          <select class="lineSelect" id="fromLine"></select>
          <select class="stationSelect" id="fromStation"></select>
        </div>
      </div>

      <div class="col">
        <label>経由地</label>
        <div class="viaList" id="viaList"></div>
        <button id="addViaBtn" class="primary">経由地を追加</button>
      </div>

      <div class="col">
        <label>着駅</label>
        <div style="display:flex;gap:6px">
          <select class="lineSelect" id="toLine"></select>
          <select class="stationSelect" id="toStation"></select>
        </div>
      </div>

      <div style="display:flex;align-items:flex-end;">
        <button id="searchBtn" class="primary">検索</button>
      </div>
    </div>
  </div>
</div>

<div id="resultArea"></div>
</div>

<script>
// ==== 駅・路線データ ====
const stationLines = {
 "新里鉄道湯の浜線":["豊町","東豊町","清水浜","安田町","南栃原","栃原","宇城","須川","御浜埼公園","御浜","伊坂","垳下","北浜","西新里","新里","河岸","新里海浜公園","湯の浜海岸","湯の浜","七浦","那珂町","宇多野","伊奈崎","鶴宮神社","鶴宮","北鶴宮"],
 "新里鉄道燠野線":["湯の浜","新里大学前","綾原","福来","燠野","湯川","温泉口","燠野温泉"],
 "新里鉄道鶴宮線":["鶴宮","南鶴宮","あずさ台","橘町","燠野山口","白枝","燠野","紅葉台","桐山","湊川","彩山親水公園","彩山","蓮華寺","星宮","田ノ原"],
 "新里鉄道新里線":["新里","南新里","田ノ原","北玖川","玖川","中野原"],
 "新里鉄道彩山線":["彩山","彩山口","新里国際スキー場","鷹見台","久我原","浪原","深江","三栗谷","桜川公園","桜川"],
 "鈴浜電気鉄道鈴浜電鉄線":["桜川国際空港","りんくう桜川","余田","白砂","千種園","大三浜","外神","紅原台","恋野宮","南河都","河都","北河都","百合ヶ丘公園","猫崎海岸","籾井","白木稲荷","流沢温泉口","流沢温泉","京新峡","奥沢高原","原津","神道山口","新的場","虹川","片牧町","鬼越峠","北鶴宮"],
 "桜川電気鉄道彩山線":["喜多瀬浜","喜多瀬","久我山","桜鉄彩山口"],
 "桜川電気鉄道空港線":["桜川","公園東口","桜川公園北口","御厨","南深江","北深江","桜鉄浪原","東浪原","喜多瀬浜","葵台","汐見台","月野原","高瀬","結原","りんくう桜川","桜川国際空港"],
 "桜川電気鉄道桜州環状線":["八軒町","川渡","西中野","中野","東中野","桜台","福原","桜鉄久我原","浪原","桜鉄浪原","彩山川","似島","中洲","糸島","南糸島","野瀬","新浜","海岸通り","桜町","東片野","東新地","新地"],
 "桜川電気鉄道中野線":["中野","南中野","大里","栄町","北桜川","桜川","南桜川","東豊野","すすき野","永田","平川","片野","北新地","新地"],
 "豊野鉄道豊野線":["糸島","西糸島","平田","文京町","東桜川","桜川","豊野月見台","豊野","西豊野","白州川","春田","桜峠","桑畑","常盤台","天津川","広野","追分","野川","幕生","羽草","清見台","東園木","園木"],
 "豊野鉄道新地線":["春田","南春田","日野原","加納","永楽町","室町","西新地","新地"],
 "豊野鉄道坂川線":["桑畑","北桑畑","坂川","天津温泉"],
 "坂津電鉄坂津本線":["北鶴宮","坂津温泉口","坂津温泉","北坂津","南坂津","坂津山口","砂浜町","坂津海岸","坂津海浜公園","坂津港","坂津港東口","坂津港南口","坂津駅前","坂津"],
 "坂津電鉄北坂津線":["坂津","北坂津","坂津港北口","坂津港","坂津南口","坂津港東口","坂津駅前","坂津温泉","坂津温泉口"]
};

// ==== 会社データ ====
const companies = {
  "新里鉄道":["新里鉄道湯の浜線","新里鉄道燠野線","新里鉄道鶴宮線","新里鉄道新里線","新里鉄道彩山線"],
  "鈴浜電気鉄道":["鈴浜電気鉄道鈴浜電鉄線"],
  "桜川電気鉄道":["桜川電気鉄道彩山線","桜川電気鉄道空港線","桜川電気鉄道桜州環状線","桜川電気鉄道中野線"],
  "豊野鉄道":["豊野鉄道豊野線","豊野鉄道新地線","豊野鉄道坂川線"],
  "坂津電鉄":["坂津電鉄坂津本線","坂津電鉄北坂津線"]
};

// ==== 補助関数 ====
// 路線内駅インデックス
function stationIndex(lineName, stationName){
  return stationLines[lineName].indexOf(stationName);
}

// 駅から路線を探す
function linesOfStation(station){
  return Object.keys(stationLines).filter(line=>stationLines[line].includes(station));
}

// 会社を返す
function companyOfLine(line){ 
  for(const [comp, lines] of Object.entries(companies)){
    if(lines.includes(line)) return comp;
  }
  return null;
}

// 最短経路 (シンプル版)
function shortestPath(start, end){
  // 同じ路線にあればそのまま返す
  const linesStart = linesOfStation(start);
  const linesEnd = linesOfStation(end);
  for(const l of linesStart){
    if(linesEnd.includes(l)){
      const idxS = stationIndex(l,start);
      const idxE = stationIndex(l,end);
      if(idxS<idxE) return {path:stationLines[l].slice(idxS,idxE+1)};
      else return {path:stationLines[l].slice(idxE,idxS+1).reverse()};
    }
  }
  // 簡易: 共通駅を探して中継
  for(const l1 of linesStart){
    for(const s1 of stationLines[l1]){
      for(const l2 of linesEnd){
        if(stationLines[l2].includes(s1)){
          // start -> s1 -> end
          const seg1 = shortestPath(start,s1).path;
          const seg2 = shortestPath(s1,end).path.slice(1); // 重複駅削除
          return {path:seg1.concat(seg2)};
        }
      }
    }
  }
  return {path:[]};
}

// 全駅経路生成 (会社跨ぎOK)
function buildFullPath(from, viaStations, to){
  const waypoints = [from, ...viaStations, to];
  let fullPath = [];
  let visited = new Set();
  for(let i=0;i<waypoints.length-1;i++){
    const a = waypoints[i], b = waypoints[i+1];
    const sp = shortestPath(a,b);
    if(!sp.path.length) return null;
    const segment = sp.path.filter(st=>!visited.has(st));
    fullPath.push(...segment);
    segment.forEach(st=>visited.add(st));
  }
  return fullPath;
}

// 会社ごとに分割して運賃計算
function splitByCompany(fullPath){
  let segments=[];
  let currComp = null, segStart = 0;
  for(let i=0;i<fullPath.length;i++){
    const station = fullPath[i];
    const lines = linesOfStation(station);
    const comp = lines.length>0?companyOfLine(lines[0]):null;
    if(comp !== currComp){
      if(currComp!==null){
        segments.push({company:currComp, from:fullPath[segStart], to:fullPath[i-1]});
      }
      segStart = i;
      currComp = comp;
    }
  }
  if(currComp!==null){
    segments.push({company:currComp, from:fullPath[segStart], to:fullPath[fullPath.length-1]});
  }
  return segments;
}

// 運賃サンプル
function fareByCompany(company, distance){ return distance*150; }

// ==== 描画 ====

// 停車駅描画
function renderRouteCardForPart(path){
  let html=`<div class="card routeLine">`;
  for(let i=0;i<path.length;i++){
    const st = path[i];
    html+=`<div class="rowStation"><div class="railCol"><div class="railDot"></div>${i<path.length-1?'<div class="railLineMajor" style="height:48px"></div>':''}</div><div class="stationText"><p class="stationName">${st}</p></div></div>`;
  }
  html+=`</div>`;
  return html;
}

// ==== UI 制御 ====
const fromLineSel=document.getElementById("fromLine");
const fromStationSel=document.getElementById("fromStation");
const toLineSel=document.getElementById("toLine");
const toStationSel=document.getElementById("toStation");
const resultArea=document.getElementById("resultArea");
const viaListDiv=document.getElementById("viaList");
const addViaBtn=document.getElementById("addViaBtn");

function populateLineSelect(sel){
  sel.innerHTML="";
  Object.keys(stationLines).forEach(l=>{
    const opt=document.createElement("option"); opt.value=l; opt.textContent=l; sel.appendChild(opt);
  });
}
function populateStationSelect(lineSel, stationSel){
  const line = lineSel.value;
  stationSel.innerHTML="";
  stationLines[line].forEach(s=>{
    const opt=document.createElement("option"); opt.value=s; opt.textContent=s; stationSel.appendChild(opt);
  });
}

populateLineSelect(fromLineSel);
populateLineSelect(toLineSel);
populateStationSelect(fromLineSel, fromStationSel);
populateStationSelect(toLineSel, toStationSel);

fromLineSel.addEventListener("change",()=>populateStationSelect(fromLineSel, fromStationSel));
toLineSel.addEventListener("change",()=>populateStationSelect(toLineSel, toStationSel));

addViaBtn.addEventListener("click",()=>{
  const viaDiv=document.createElement("div"); viaDiv.className="viaRow";
  const viaInput=document.createElement("select");
  populateLineSelect(viaInput);
  viaDiv.appendChild(viaInput);
  const viaStation=document.createElement("select");
  populateStationSelect(viaInput, viaStation);
  viaDiv.appendChild(viaStation);
  viaInput.addEventListener("change",()=>populateStationSelect(viaInput, viaStation));
  const removeBtn=document.createElement("button"); removeBtn.textContent="削除"; removeBtn.addEventListener("click",()=>viaDiv.remove());
  viaDiv.appendChild(removeBtn);
  viaListDiv.appendChild(viaDiv);
});

document.getElementById("searchBtn").addEventListener("click",()=>{
  const from=fromStationSel.value;
  const to=toStationSel.value;
  const viaStations=[];
  viaListDiv.querySelectorAll(".viaRow").forEach(row=>{
    const s=row.children[1].value; if(s) viaStations.push(s);
  });
  const fullPath=buildFullPath(from, viaStations, to);
  if(!fullPath) { alert("経路が見つかりません"); return; }
  const fareSegs=splitByCompany(fullPath);
  let totalFare=0;
  fareSegs.forEach(seg=>{
    const sp=shortestPath(seg.from, seg.to);
    const dist=sp.path.length-1;
    totalFare+=fareByCompany(seg.company,dist);
  });
  resultArea.innerHTML=`<div class="resultHeader"><div class="meta">合計駅数:${fullPath.length} 運賃概算:${totalFare}円</div></div>`+renderRouteCardForPart(fullPath);
});
</script>
</body>
</html>
